<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script src="../lib/Whiteboard/Whiteboard.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
</head>
<body>
  <main id="app"></main>
  <script>
    const socket = io('http://localhost:3000');
    // socket client functions
    function emitDrawData(x, y, width, height) {
      socket.emit('draw', { x, y, width, height });
    }

    const app = document.getElementById('app');
    const canvas = document.createElement('canvas');
    app.append(canvas);

    // Array to store rectangles
    const rectangles = [];

    // testing Whiteboard Class
    const whiteboard = new Whiteboard(canvas);
    console.log(whiteboard);

    // Event listeners to trigger drawing
    canvas.addEventListener('mousedown', whiteboard.startDrawing);

    // canvas.addEventListener('mousemove', whiteboard.drawLine);
    canvas.addEventListener('mousemove', (e) => {
      let { x,y,height,width } = whiteboard.getRectValues(e);
      whiteboard.drawRect(x, y, width, height);
      whiteboard.drawShapes(rectangles);
      emitDrawData(x, y, width, height);
    });
    socket.on('draw', (data) => {
      console.log('DATA FROM OTHER CLIENT', data);
      whiteboard.drawRect(data.x, data.y, data.width, data.height);
    });
    canvas.addEventListener('mouseup', (e) => {
      rectangles.push(whiteboard.getRectValues(e));
      whiteboard.stopDrawing(e);
    });
    canvas.addEventListener('mouseout', whiteboard.stopDrawing);
    window.addEventListener('resize', whiteboard.resizeCanvas);
    whiteboard.resizeCanvas(); // Initial call
  </script>
</body>
</html>